{% extends 'base.html.twig' %}

{% block title %}Mis Notificaciones{% endblock %}

{% block body %}
    <div class="card card-custom">
        <div class="card-header">
            <div class="card-title">
                <h3 class="card-label">Mis Notificaciones</h3>
            </div>
            <div class="card-toolbar">
                {% if is_granted('ROLE_ADMIN') %}
                    <a href="{{ path('notificacion_new') }}" class="btn btn-primary font-weight-bold">
                        <i class="fa fa-plus"></i> Nueva Notificación
                    </a>
                {% endif %}
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-hover table-checkable" id="kt_datatable_notificaciones" style="width: 100%">
                    <thead>
                    <tr>
                        <th>Estado</th>
                        <th>Título</th>
                        <th>Contenido</th>
                        <th>Fecha</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for notificacion in notificaciones %}
                        <tr>
                            <td class="text-center">
                                {% if not notificacion.leida %}
                                    <span class="label label-light-primary label-inline">Nuevo</span>
                                {% else %}
                                    <i class="flaticon-bell text-muted"></i>
                                {% endif %}
                            </td>
                            <td>{{ notificacion.titulo }}</td>
                            <td>{{ notificacion.contenido|striptags|raw|slice(0, 100) }}{% if notificacion.contenido|length > 100 %}...{% endif %}</td>
                            <td>{{ notificacion.fechaCreacion|date('d/m/Y H:i') }}</td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="4" class="text-center">No hay notificaciones para mostrar.</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <!-- Agrega esto justo antes de cerrar el bloque javascripts -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap4.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css">

    <script>
        // Esperamos a que jQuery esté completamente cargado
        if (typeof $ !== 'undefined') {
            $(document).ready(function() {
                $('#kt_datatable_notificaciones').DataTable({
                    responsive: true,
                    language: {
                        url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                    },
                    order: [[3, 'desc']],
                    pageLength: 5,
                    lengthMenu: [[5, 10, 25, 50, -1], [5, 10, 25, 50, "Todos"]],
                    columnDefs: [
                        { orderable: false, targets: [0] },
                        { width: '10%', targets: 0 },
                        { width: '20%', targets: 1 },
                        { width: '50%', targets: 2 },
                        { width: '20%', targets: 3 }
                    ]
                });
            });
        } else {
            console.error('jQuery no está cargado correctamente');
        }
    </script>
{% endblock %}